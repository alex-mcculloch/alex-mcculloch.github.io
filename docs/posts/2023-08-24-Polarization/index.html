<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alexandar McCulloch">
<meta name="dcterms.date" content="2023-08-24">
<meta name="description" content="Americans agree on social and economic policy more often than is assumed">

<title>Alexandar McCulloch - Americans are Not as Polarized as We Think</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Alexandar McCulloch</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/alexandar-mcculloch/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text">LinkedIn</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:asmcculloch46@gmail.com" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text">Email</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Resume.pdf" rel="" target=""><i class="bi bi-file-text" role="img">
</i> 
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://alexandarmcculloch.substack.com/" rel="" target="">
 <span class="menu-text">Substack</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Americans are Not as Polarized as We Think</h1>
                  <div>
        <div class="description">
          Americans agree on social and economic policy more often than is assumed
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">US Politics</div>
                <div class="quarto-category">Polarization</div>
                <div class="quarto-category">Public Opinion</div>
                <div class="quarto-category">State Politics</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://alex-mcculloch.github.io/">Alexandar McCulloch</a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://ctveteranslegal.org/">
              Data Analyst @ the Connecticut Veterans Legal Center
              </a>
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 24, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#polarization-in-congress" id="toc-polarization-in-congress" class="nav-link active" data-scroll-target="#polarization-in-congress">Polarization in Congress</a></li>
  <li><a href="#polarization-among-the-public" id="toc-polarization-among-the-public" class="nav-link" data-scroll-target="#polarization-among-the-public">Polarization Among the Public</a>
  <ul class="collapse">
  <li><a href="#shared-preferences" id="toc-shared-preferences" class="nav-link" data-scroll-target="#shared-preferences">Shared Preferences</a></li>
  <li><a href="#voter-impact" id="toc-voter-impact" class="nav-link" data-scroll-target="#voter-impact">Voter Impact</a></li>
  <li><a href="#conflict-extension" id="toc-conflict-extension" class="nav-link" data-scroll-target="#conflict-extension">Conflict Extension</a></li>
  <li><a href="#affective-politics" id="toc-affective-politics" class="nav-link" data-scroll-target="#affective-politics">Affective Politics</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>In 1950, the American Political Science Association (APSA) published a 99-page report urging the two major parties in America to become more centrally organized and nationally focused. The genesis of this report stemmed from the APSA’s concern that the parties did little to distinguish themselves and lacked an authoritative leadership structure that could provide clear and concise platforms.</p>
<p>Not all political scientists agreed with the report’s recommendations, but it represents a state of politics that is so foreign to us today. Seventy years ago the concern was the lack of polarization, today we exclaim there is too much. So much so that polarization has been credited with a substantial amount of blame for a decline in democratic performance, that is because, in a polarized nation, a party-controlling government has a greater incentive to take institutions designed to protect democratic norms and transform them into authoritarian instruments.</p>
<p>Assessing the current state of polarization in America and its impact on voters is a complex undertaking due to the multitude of methods available for measuring polarization, each with its unique strengths and limitations. Moreover, polarization can be examined at two primary levels: among political elites, which pertains to politicians, and among the general electorate.</p>
<p>These two levels of analysis often yield different results. That is why in the following sections, I will explore polarization at both the elite and voter levels and examine possible reasons for variations between the two.</p>
<section id="polarization-in-congress" class="level2">
<h2 class="anchored" data-anchor-id="polarization-in-congress">Polarization in Congress</h2>
<p>To gauge the extent of polarization in the United States, I rely on a valuable tool employed by political scientists – the DW-NOMINATE dataset. Developed by Keith Poole and Howard Rosenthal this dataset provides a means to quantify and track the ideological positions of members of Congress. These scores are calculated using votes cast by each member of Congress. Once these scores are obtained, we can calculate the rate of elite polarization by calculating the difference between the average scores of Republicans and Democrats.</p>
<p>The following two graphs illustrate the average nominate scores of Republicans, Northern Democrats, Democrats, and Southern Democrats in the House of Representatives and Senate. These scores reflect the liberal-conservative spectrum, ranging from -1 (most liberal) to 1 (most conservative).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/cong polar-1.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/cong polar-2.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Senate and House Republicans have exhibited a more rapid rightward shift compared to the gradual leftward movement of Democrats. We can see this increased rate of change begin in the late 1960s and continue through 2023.</p>
<p>This change in Republican ideology can be attributed to the civil rights movements of the 1960s and 1970s. However, we should be careful not to attribute the source of our growing polarization to the large shift within the Republican party. The causes and effects of polarization are complicated and our research on the subject is ongoing.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/hs_sen polar-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>The graphs above show a clear trend of growing polarization at the elite level. However, politicians are not the most accurate portrayal of the average American. Yes, members of Congress are voted in by their constituents, however, that does not mean they adopt the same preferences as the average voter.</p>
</section>
<section id="polarization-among-the-public" class="level2">
<h2 class="anchored" data-anchor-id="polarization-among-the-public">Polarization Among the Public</h2>
<section id="shared-preferences" class="level3">
<h3 class="anchored" data-anchor-id="shared-preferences">Shared Preferences</h3>
<p>There is strong evidence to suggest the United States is not as polarized as most claim. Rather, the extreme polarization that is documented can be attributed to a specific group of individuals that represent ideologues and party activists.</p>
<p>To gauge the level of polarization among voters, I replicate findings from Levendusky and Pope’s 2011 paper <em>Red States vs.&nbsp;Blue States: Going Beyond the Mean</em>. It is typical for researchers to conduct a simple difference-in-differences (DiD) test to determine polarization. Indeed, the visuals from the previous section are the result of a DiD test.</p>
<p>I can do the same test to determine the rate of polarization at the voter level, however, Levendusky and Pope offer an alternative. Rather than a simple difference in means, I pool all blue-state and red-state voters into two groups and plot the distribution of their policy preferences. By using density plots we can visualize the distribution of voters’ policy preferences along the liberal-conservative spectrum. The peaks and valleys of the curve indicate where data points are more or less concentrated. This way, we can not only view the unique preferences between the two groups, but also gauge the overlap, or shared preferences, between red- and blue-state voters.</p>
<p>I create two issue dimensions: economic and social. These dimensions are defined by a collection of survey questions that measure respondents’ attitudes on issues such as spending, social security, abortion, immigration, and affirmative action.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/eco pref-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/soc pref-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>What is striking about the graphs above is the remarkable level of overlap between red and blue states, with a <strong>91% and 89% overlap in economic and social policy preferences</strong>, respectively. This suggests that the general public may not be as polarized as commonly assumed. In fact, these visuals indicate quite the opposite – the American public largely agrees on numerous issues spanning economic and social dimensions.</p>
<p>For a formal analysis, I calculate the probability that a random blue-state voter is more liberal than a random red-state voter. The results reveal that <strong>a blue-state resident is 55% more likely to hold liberal views on the economic dimension and 56% more likely to do so on the social dimension</strong>. While blue-state voters tend to lean more liberal than their red-state counterparts, the difference is roughly akin to a coin toss.</p>
<p>The evidence here suggests that red- and blue-state voters share similar preferences. Indeed, even blue states have conservatives and Republicans just as red states have liberals and Democrats. However, it’s essential to consider whether these visuals might obscure crucial information. The notion that the U.S. is not as polarized as commonly assumed raises the question of whether conventional wisdom is misrepresenting reality or if our tests fail to capture the full extent of this phenomenon.</p>
<p>Partisans tend to be more active and vocal than the average citizen. Therefore, the polarization we often identify might stem from the divisive rhetoric and actions taken by Democrats and Republicans themselves. This partisan divide may be better understood as a division within a specific subgroup rather than a divide between all voters.</p>
<p>The graphs below illustrate a more substantial divide between blue-state Democrats and red-state Republicans. While distinct from the previous visuals, these graphs clearly show a large overlap between Democrats and Republicans. <strong>The overlap between partisans on the economic dimension is 35% while the overlap for social policy stands at 48%.</strong></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/soc partisans-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/eco partisans-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>After examining these graphs, one can still claim there is still polarization among the American electorate. That is not unreasonable, as polarization is inherent in politics. However, the polarization we observe can largely be characterized as partisan polarization – polarization driven by partisans, rather than average voters.</p>
<p>The high level of elite polarization begins to make sense as we observe higher levels of partisan polarization within the electorate. Partisans are more active, they participate in primaries and often hold opinions that are more extreme than their less active peers. Therefore, while we observe less polarization within the entire electorate compared to Congress, the Senators and Representatives who represent these voters most accurately reflect the values of the active voter rather than the passive one.</p>
</section>
<section id="voter-impact" class="level3">
<h3 class="anchored" data-anchor-id="voter-impact">Voter Impact</h3>
<p>Some argue that the perception of increased polarization is, in fact, a result of better partisan sorting. Partisan sorting involves the alignment of political party affiliation with ideological beliefs. This process leads to greater ideological homogeneity within political parties, such as Democrats becoming predominantly liberal and Republicans predominantly conservative.</p>
<p>This is distinct from the idea that the public and elected officials are adopting increasingly ideologically extreme and distinct policy positions. Evidence supports the existence of both a better-sorted electorate and a more polarized one. Regardless of one’s preferred interpretation, researchers are still able to identify specific consequences affecting the public.</p>
</section>
<section id="conflict-extension" class="level3">
<h3 class="anchored" data-anchor-id="conflict-extension">Conflict Extension</h3>
<p>Polarization’s growth has introduced voters to new challenges. One notable phenomenon is conflict extension. Unlike the past, when parties primarily disagreed on a few major policy areas like slavery, civil rights, and the New Deal, contemporary polarization spans almost every policy domain. For instance, someone who takes a liberal stance on LGBTQ issues is now more likely to also hold liberal positions on topics such as abortion, gun control, taxation, and environmental regulation. The range of issues over which the two major parties clash has significantly expanded.</p>
<p>The question here becomes, who is leading this process? Evidence suggests that party activists are the engine behind this movement. This is for reasons I previously stated. Activists are more likely to harbor ideologically extreme positions and introduce new salient issues to the party.</p>
<p>Furthermore, changes to the party system have made the party more accessible to activists. Barriers have dropped since the 1960s, which makes this one contribution to the increasingly polarized climate.</p>
</section>
<section id="affective-politics" class="level3">
<h3 class="anchored" data-anchor-id="affective-politics">Affective Politics</h3>
<p>Partisan affiliations not only shape our political beliefs but also impact our emotional reactions toward our political adversaries. As people become better sorted, they tend to exhibit more bias, and experience heightened emotional fluctuations. Those with strong partisan identities not only display hostility toward those outside their group but are also driven toward political activism. This phenomenon operates independently of one’s actual policy positions. Political parties start resembling one’s favorite sports team, motivating voters to become more engaged, not necessarily to promote specific policies, but rather for their team to win or the opposition to lose.</p>
<p>Furthermore, as one social group clashes with another, our group’s identity takes on a central role in defining their individual identity. Consequently, as partisan competition intensifies, citizens tend to approach politics more as Democrats and Republicans rather than as American voters.</p>
<p>This confrontational approach to politics can give the impression that we are more polarized on issues than we truly are. This is because we can visibly perceive and feel a growing social polarization, which is expanding at a faster rate than polarization based on policy positions.</p>
<hr>
<p>The current state of American polarization is a complex and multifaceted phenomenon. The nation’s political landscape is undeniably more polarized than it was at the publication of the APSA’s report. The historical context reveals a stark transformation from a concern about the lack of polarization to the contemporary alarm of its excess.</p>
<p>The concern today refers to social polarization more than issue-based polarization. As our identities become consumed by our political ones, we become more concerned with our side winning. As ideology and partisanship converge, voters are driven to activism, the group primarily responsible for the growing polarization observed in Congress and the overall issue-based polarization across the country.</p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mcculloch2023,
  author = {McCulloch, Alexandar},
  title = {Americans Are {Not} as {Polarized} as {We} {Think}},
  date = {2023-08-24},
  url = {https://alex-mcculloch.github.io/posts/2023-08-24-Union-Attitudes/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mcculloch2023" class="csl-entry quarto-appendix-citeas" role="listitem">
McCulloch, Alexandar. 2023. <span>“Americans Are Not as Polarized as We
Think.”</span> August 24, 2023. <a href="https://alex-mcculloch.github.io/posts/2023-08-24-Union-Attitudes/">https://alex-mcculloch.github.io/posts/2023-08-24-Union-Attitudes/</a>.
</div></div></section></div></main> <!-- /main -->


<div>
<hr>

<h3> Stay in touch </h3>

<p> If you enjoyed this post, then don't miss out on any future posts by subscribing to my email newsletter. </p>

<iframe id="beehiiv-form" src="https://embeds.beehiiv.com/9232d2a2-6e85-4beb-b8ed-1de94e9e4f01?slim=true" data-test-id="beehiiv-embed" frameborder="0" scrolling="no" style="margin: 0; border-radius: 0px !important; background-color: transparent; height: 55px; border: 2px solid #0c7677' color: #0c7677;"></iframe>

<hr>
</div>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>